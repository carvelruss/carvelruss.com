<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Housing Loan Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f6f9;
            margin: 20px;
        }

        .card {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        h2 {
            margin-bottom: 15px;
        }

        input {
            margin: 10px 0;
            padding: 8px;
            width: 100%;
            font-size: 1rem;
        }

        button {
            padding: 10px 15px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
        }

        button:hover {
            background: #0056b3;
        }

        .results p {
            font-size: 1.1rem;
            margin: 6px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: right;
        }

        th {
            background: #007bff;
            color: white;
        }

        td:first-child,
        th:first-child {
            text-align: center;
        }
    </style>
</head>

<body>

    <!-- Loan Calculator Card -->
    <div class="card">
        <h2>Housing Loan Calculator</h2>
        <label>Loan Amount (₱):</label>
        <input type="text" id="loanAmount" placeholder="Enter loan amount" oninput="formatLoanAmount(this)">

        <label>Down Payment (₱):</label>
        <input type="text" id="downPayment" placeholder="Enter down payment (optional)"
            oninput="formatLoanAmount(this)">

        <label>Annual Interest Rate (%):</label>
        <input type="number" id="interestRate" placeholder="Enter interest rate">

        <label>Loan Term (Years):</label>
        <input type="number" id="loanTerm" placeholder="Enter loan term">

        <button onclick="calculateLoan()">Calculate</button>

        <div class="results">
            <p id="monthlyPayment"></p>
            <p id="totalRepayment"></p>
            <p id="totalInterest"></p>
        </div>
    </div>

    <!-- Charts Card -->
    <div class="card">
        <h2>Loan Breakdown</h2>
        <canvas id="paymentChart"></canvas>
        <br>
        <canvas id="breakdownChart"></canvas>
    </div>

    <!-- Amortization Schedule Card -->
    <div class="card">
        <h2>Amortization Schedule</h2>
        <table id="amortizationTable">
            <thead>
                <tr>
                    <th>Month</th>
                    <th>Principal Paid (₱)</th>
                    <th>Interest Paid (₱)</th>
                    <th>Remaining Balance (₱)</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        let paymentChart, breakdownChart;

        // Format input with commas
        function formatLoanAmount(input) {
            let value = input.value.replace(/,/g, '');
            if (!isNaN(value) && value !== '') {
                input.value = Number(value).toLocaleString();
            }
        }

        // Format numbers into currency with ₱ and commas
        function formatCurrency(num) {
            return "₱" + num.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        function calculateLoan() {
            let loanAmount = parseFloat(document.getElementById("loanAmount").value.replace(/,/g, '')) || 0;
            let downPayment = parseFloat(document.getElementById("downPayment").value.replace(/,/g, '')) || 0;
            let interestRate = parseFloat(document.getElementById("interestRate").value) / 100 / 12;
            let loanTerm = parseFloat(document.getElementById("loanTerm").value) * 12;

            let principal = loanAmount - downPayment;

            if (principal <= 0 || interestRate <= 0 || loanTerm <= 0) return;

            let monthlyPayment = (principal * interestRate) / (1 - Math.pow(1 + interestRate, -loanTerm));
            let totalRepayment = monthlyPayment * loanTerm;
            let totalInterest = totalRepayment - principal;

            // Update results
            document.getElementById("monthlyPayment").innerText = "Monthly Payment: " + formatCurrency(monthlyPayment);
            document.getElementById("totalRepayment").innerText = "Total Repayment: " + formatCurrency(totalRepayment);
            document.getElementById("totalInterest").innerText = "Total Interest: " + formatCurrency(totalInterest);

            // Update charts
            updateCharts(monthlyPayment, principal, totalInterest);

            // Update amortization table
            updateAmortizationTable(principal, monthlyPayment, interestRate, loanTerm);
        }

        function updateCharts(monthlyPayment, principal, totalInterest) {
            if (paymentChart) paymentChart.destroy();
            if (breakdownChart) breakdownChart.destroy();

            const ctx1 = document.getElementById('paymentChart').getContext('2d');
            paymentChart = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: ['Monthly Payment'],
                    datasets: [{
                        label: '₱ per month',
                        data: [monthlyPayment],
                        backgroundColor: '#007bff'
                    }]
                }
            });

            const ctx2 = document.getElementById('breakdownChart').getContext('2d');
            breakdownChart = new Chart(ctx2, {
                type: 'pie',
                data: {
                    labels: ['Principal', 'Interest'],
                    datasets: [{
                        data: [principal, totalInterest],
                        backgroundColor: ['#28a745', '#dc3545']
                    }]
                }
            });
        }

        function updateAmortizationTable(principal, monthlyPayment, interestRate, loanTerm) {
            const tableBody = document.getElementById("amortizationTable").querySelector("tbody");
            tableBody.innerHTML = "";

            let balance = principal;

            for (let month = 1; month <= loanTerm; month++) {
                let interestPayment = balance * interestRate;
                let principalPayment = monthlyPayment - interestPayment;
                balance -= principalPayment;

                const row = `<tr>
                    <td>${month}</td>
                    <td>${formatCurrency(principalPayment)}</td>
                    <td>${formatCurrency(interestPayment)}</td>
                    <td>${formatCurrency(Math.max(balance, 0))}</td>
                </tr>`;

                tableBody.innerHTML += row;
            }
        }
    </script>

</body>

</html>